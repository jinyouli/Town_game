{"version":3,"sources":["../../../../assets/scripts/assets/scripts/nav_agent.js"],"names":["map_gen","require","cc","Class","extends","Component","properties","speed","map","type","default","start","road_set","get_road_set","road_data","next_step","is_walking","walk_on_road","length","node","setPosition","walk_on_next","src","getPosition","dst","dir","sub","len","mag","walk_time","now_time","vx","x","vy","y","update","dt"],"mappings":";;;;;;AAAA,IAAIA,UAAUC,QAAQ,SAAR,CAAd;;AAEAC,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;;AAERC,eAAQ,GAFA;;AAIRC,aAAM;AACFC,kBAAMT,OADJ;AAEFU,qBAAU;AAFR;AAJE,KAHP;;AAaLC,SAbK,mBAaI;AACL,aAAKC,QAAL,GAAgB,KAAKJ,GAAL,CAASK,YAAT,EAAhB;;AAEA,aAAKC,SAAL,GAAiB,KAAKF,QAAL,CAAc,CAAd,CAAjB;AACA,aAAKG,SAAL,GAAiB,CAAjB;AACA,aAAKC,UAAL,GAAkB,KAAlB;AACA,aAAKC,YAAL;AACH,KApBI;AAsBLA,gBAtBK,0BAsBU;AACX,YAAG,KAAKH,SAAL,CAAeI,MAAf,GAAwB,CAA3B,EAA6B;AACzB;AACH;AACD,aAAKC,IAAL,CAAUC,WAAV,CAAsB,KAAKN,SAAL,CAAe,CAAf,CAAtB;AACA,aAAKO,YAAL;AACH,KA5BI;AA8BLA,gBA9BK,0BA8BU;AACX,YAAI,KAAKN,SAAL,IAAkB,KAAKD,SAAL,CAAeI,MAArC,EAA6C;AACzC,iBAAKF,UAAL,GAAkB,KAAlB;AACA;AACH;AACD,aAAKA,UAAL,GAAkB,IAAlB;AACA,YAAIM,MAAM,KAAKH,IAAL,CAAUI,WAAV,EAAV;AACA,YAAIC,MAAM,KAAKV,SAAL,CAAe,KAAKC,SAApB,CAAV;AACA,YAAIU,MAAMD,IAAIE,GAAJ,CAAQJ,GAAR,CAAV;AACA,YAAIK,MAAMF,IAAIG,GAAJ,EAAV;;AAEA,aAAKC,SAAL,GAAiBF,MAAM,KAAKpB,KAA5B;AACA,aAAKuB,QAAL,GAAgB,CAAhB;;AAEA,aAAKC,EAAL,GAAU,KAAKxB,KAAL,GAAakB,IAAIO,CAAjB,GAAqBL,GAA/B;AACA,aAAKM,EAAL,GAAU,KAAK1B,KAAL,GAAakB,IAAIS,CAAjB,GAAqBP,GAA/B;AACH,KA9CI;AAgDLQ,UAhDK,kBAgDGC,EAhDH,EAgDO;AACR,YAAI,KAAKpB,UAAL,IAAmB,KAAvB,EAA8B;AAC1B;AACH;;AAED,aAAKc,QAAL,IAAiBM,EAAjB;AACA,YAAI,KAAKN,QAAL,GAAgB,KAAKD,SAAzB,EAAoC;AAChCO,kBAAO,KAAKN,QAAL,GAAgB,KAAKD,SAA5B;AACH;;AAED,aAAKV,IAAL,CAAUa,CAAV,IAAgB,KAAKD,EAAL,GAAUK,EAA1B;AACA,aAAKjB,IAAL,CAAUe,CAAV,IAAgB,KAAKD,EAAL,GAAUG,EAA1B;;AAEA,YAAI,KAAKN,QAAL,IAAiB,KAAKD,SAA1B,EAAqC;AACjC,iBAAKd,SAAL;AACA,iBAAKM,YAAL;AACH;AACJ;AAjEI,CAAT","file":"nav_agent.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["var map_gen = require(\"map_gen\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        \n        speed : 100,\n\n        map : {\n            type: map_gen,\n            default : null,\n        },\n    },\n\n    start () {\n        this.road_set = this.map.get_road_set();\n\n        this.road_data = this.road_set[0];\n        this.next_step = 1;\n        this.is_walking = false;\n        this.walk_on_road();\n    },\n\n    walk_on_road() {\n        if(this.road_data.length < 2){\n            return;\n        }\n        this.node.setPosition(this.road_data[0]);\n        this.walk_on_next();\n    },\n\n    walk_on_next() {\n        if (this.next_step >= this.road_data.length) {\n            this.is_walking = false;\n            return;\n        }\n        this.is_walking = true;\n        var src = this.node.getPosition();\n        var dst = this.road_data[this.next_step];\n        var dir = dst.sub(src);\n        var len = dir.mag();\n\n        this.walk_time = len / this.speed;\n        this.now_time = 0;\n\n        this.vx = this.speed * dir.x / len;\n        this.vy = this.speed * dir.y / len;\n    },\n\n    update (dt) {\n        if (this.is_walking == false) {\n            return;\n        }\n\n        this.now_time += dt;\n        if (this.now_time > this.walk_time) {\n            dt -= (this.now_time - this.walk_time);\n        }\n\n        this.node.x += (this.vx * dt);\n        this.node.y += (this.vy * dt);\n\n        if (this.now_time >= this.walk_time) {\n            this.next_step ++;\n            this.walk_on_next();\n        }\n    },\n});\n\n\n\n\n\n\n\n"]}